# Utilizing PyTorch for Machine Learning
The folder *ML* holds the python code for executing the machine learning task.

## Processing the Data generated by LIMoSim
*process_data.py* holds methods for processing the data samples generated by LIMoSim.
```python
generate_pickle(city, corPos=True, mappedHeights=True)
```
*generate_pickle* is used to read the json files holding the features, generate a pandas Dataframe and pickle it.

```python
def process_images(city: str, size: int, _range: int, enable_threading:bool = True , number_threads:int = 8, sv:bool = True, corPos:bool = True, mappedHeights:bool = True)
```
*process_images* in then utilized to read the *eps* images generated by LIMoSim and save them as *png* files.

(The LIMoSim datasamples should be saved in a folder named "dataset_engineered", while the processed datasamples should be saved in a folder named "dataset_processed".)


## Training the Neural Network
The training of the neural network can be performed by *train.py*.
It first reads the global variables specified in *init_model.py*.
Based on these variables, the different datasets are created and the neural network is initalized.
The model is then trained for multiple epochs.
The used parameters as well as the trained model are then stored in "/models/results/exps/" 


## Evaluating the Neural Network
A trained model can be evaluated with the help of *evaluate.py*.
For the given model identifier in *init_model.py* the used parameters and the model are loaded.
Following, an evaluation of the test set is performed and the prediction results are stored in "/models/results/exps/evaluated/" as a *csv* file in the following form:
```csv
, measured, DNN, id, area, frequency, error, height, city
```
- *measured* is the target value
- *DNN* is the predicted value
- *id* is the sample id
- *area* is the name of the area in the Dortmund scenario
- *frequency* is the frequency in MHz
- *error* is the prediction error of the neural network
- *height* is the receiver's height
- *city* is the name of the city from which the sample originates


## init_model.py
*init_model.py* sets global variables:

- *base_path* (str) indicates the folder which holds the folders *dataset_engineered*, *dataset_processed* and *models*
- *city* (str) holds the acronym of the city used in *process_data.py*
- *image_sizes* (list of int) holds the size in pixels of the resulting png images converted in *process_data.py*
- *folders* (list of string) holds the different folders of the aarhus dataset
- *heights* (list of string) holds the different flight heights of the aarhus dataset
- *areas* (list of string) holds the names of the different areas included in the dortmund dataset
- *exps* (str) is the name of the model used in *evaluate.py* and *REM.py*
- *final_file* (str) holds the name of the output file of *evaluate.py*
- *REM_folder* (str) holds the path to the REM dataset to use in *REM.py* (relative to the base path)
- *cuda* (bool) indicates whether to use cuda or cpu
- *wandb* (bool) indiactes whether to track results with wandb
- *wandb_project* (str) holds the name of the wandb project
- *kernels* (list of int) holds the convolution kernels of the NN
- *max_pool* (list of int) holds the max pooling sizes
- *out_channels* (list of int) holds the output sizes of the convolution blocks
- *nn_layers* (list of int) holds the size of the feature neural network
- *pathloss_models* (bool) indicates whether to use the pathloss model in the machine learning part or not
- *engineered_features* (bool) indicates whether to use the engineered features ("indoorDist", "indoorIntersections", "terrainDist", "terrainIntersections") in the feature vector
- *im_model* (bool) indicates whether to use the image samples or not
- *feature_model* (bool) indicates whether to use the feature neural network or not
- *mapped_heights* (bool) indicates whether to use the corrected building heights or not
- *corrected_position* (bool) indicates whether to use the corrected transmitter positions or not
- *offset_per_cell* (bool) indicates whether to use the calculated offset per cell or per area and frequency
- *REM* (bool) indicates whether to use the averaged RSRP values or raw ones
- *REM_size* (int) indicates the cell size in meters of the averaging process
- *dilation* (int) holds the dilation factor used in the convolutions
- *padding* (int) holds the number of padding units added
- *stride* (int) holds the stride used in the convolutions
- *data_augmentation* (int) holds the maximum absolut image rotation angle in degrees
- *dortmund* (bool) indicates whether to use the dortmund dataset or not
- *aarhus* (bool) indicates whether to use the aarhus dataset or not
- *kopenhagen* (bool) indicates whether to use the kopenhagen dataset or not
- *wuppertal* (bool) indicates whether to use the wuppertal dataset or not
- *seed* (int) holds the seed value used
- *batch_size* (int) holds the batch size used in training of the model
- *sv* (true) indicates whether to include side view samples or not
- *tv* (true) indicates whether to include top view samples or not
- *image_size* (int) indicates the image size in pixels used in the neural network
- *image_range* (list of int) holds the side view samples range in meters as well as the top view samples range in meters (-1 indicates the full range)
- *test_size* (float) holds the portion which should be used for testing (or is set to None)
- *testset* (str) holds the name of the dataset used as test set (or is set to None)
- *val_size* (float) holds the portion which should be used for validation (or is set to None)
- *valset* (str) holds the name of the dataset used as validation set (or is set to None)
- *test* (bool) indicates whether to evaluate test samples during training or not
- *drop_data* (float) holds the portion of data samples to be dropped
- *num_workers* (int) holds the number of threads used in training and evaluating the neural network
- *epochs* (int) holds the maximum number of epochs
- *weight_decay* (float) holds the weight decay factor
- *learning_rate* (float) holds the initial learning rate 
- *dropout* (float) holds the drop out rate
- *load_images* (bool) indicates whether to load the images in advance or not
- *use_multi_epochs_loader* (bool) indicates to use the multi epochs data loade class or the classic one

